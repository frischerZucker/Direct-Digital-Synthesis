\section{Spezifikation des Systems}
\label{sec:spezifikation}
\subsection{Aufgabe}
\label{subsec:aufgabe}
Ziel des Projektes ist die Entwicklung eines Signalgenerators nach dem Prinzip der 
Direct-Digital-Synthesis, der in der Lage ist, ein Sinussignal mit variabler 
Frequenz zu generieren. Die Auswahl der Frequenz erfolgt über die sich auf dem Board
befindenden Taste Das System soll dabei folgende Eigenschaften aufweisen:
\begin{itemize}
    \item 48,828 kHz Referenzfrequenz
    \item 10 bit Ausgangsamplitude
    \item 12 bit Phasenauflösung
    \item 12 Hz Frequenzauflösung
    \item 10 bit Auflösung des Frequenzkontrollregisters
\end{itemize} 

\subsection{Ein- und Ausgänge des Systems}
\label{subsec:system_io}
Das System benötigt nicht sonderlich viele Ein- und Ausgänge.
Als Eingänge werden Taster zur Auswahl der Frequenz benötigt. Da das
Frequenzkontrollregister eine Auflösung von 10 bit hat, bietet es sich an, zehn der
auf Board vorhandenen Schalter zu nutzen. Dazu werden von diesen die Schalter SW0 
bis SW9 verwendet.
An Ausgängen wird nur einer zur Ausgabe des generierten Signals benötigt. Dazu wird
der GPIO-Pin GPIO[0] verwendet. An diesem wird ein PWM-Signal ausgegeben, das über 
einen Tiefpass in ein Sinussignal umgewandelt werden kann.

\begin{figure}[htbp]
    \centering
    \includegraphics[width=.6\linewidth]{img/io.png}
    \caption{verwendete Ein- und Ausgänge des Boards}
    \label{fig:io}
\end{figure}

\subsection{Prinzip der Direct-Digital-Synthesis}
\label{subsec:prinzip}
Ein Signalgenerator nach dem Prinzip der Direct-Digital-Synthesis besteht aus mehreren Blöcken.
Der erste Block ist der \textbf{Phasenakkumulator}. Dieser berechnet in jedem Taktschritt den neuen Phasenwert,
indem er den Frequenzauswahlwert auf den aktuellen Zählstand addiert.
Der nächste Teil ist die \textbf{Koeffiziententabelle}. In dieser sind gesampelte Amplitudenwerte der zu 
generierenden Funktion gespeichert.
Der \textbf{PWM-Generator} liest mithilfe des vom Phasenakkumulator generierten
Phasenwerts einen Amplitudenwert aus der Koeffiziententabelle aus und wandelt diesen in ein PWM-Signal um.
Zum Schluss kommt ein \textbf{Tiefpassfilter}, durch den das PWM-Signal in das analoge Signal umgewandelt wird.
Er bildet gemeinsam mit dem PWM-Generator einen einfachen Analog-Digital-Wandler.

\begin{figure}[htbp]
    \centering
    \includegraphics[width=\linewidth]{img/blockschaltbild.png}
    \caption{Blockschaltbild eines DDS-Generators}
    \label{fig:blockschaltbild}
\end{figure}

\subsection{Lösungsansatz}
\label{subsec:lösungsansatz}
Zur Realisierung des DDS-Signalgenerators habe ich das System in mehrere funktionale Komponentenzerlegt.
Diese und ihre Beziehungen untereinander sind im Datenflussdiagramm DFD0 (Abbildung \ref{fig:dfd0}) dargestellt.

\begin{figure}[htbp]
    \centering
    \includegraphics[width=\linewidth]{img/dfd.png}
    \caption{DFD0}
    \label{fig:dfd0}
\end{figure}

\noindent Die Generierung der Referenzfrequenz $f_{ref}$ erfolgt über einen Taktteiler, der das Eingangssignal clk durch 1024 teilt.
Dadurch ergibt sich die gewünschte Referenzfrequenz von 48,828 kHz.
Der Taktteiler wird als ein 10-bit-Zähler realisiert, der in jedem Takt von clk inkrementiert wird.
Bei Zählerüberläufen wird ein Impuls erzeugt, der die Referenzfrequenz dargestellt.

\noindent Der Phasenakkumulator wird als 12-bit-Zähler implementiert und arbeitet mit der Referenzfrequenz als Takt.
Durch die Modulo-$2^{12}$-Operation des Zählers ergibt sich eine Phasenauflösung von 4096 Schritten.
Die Frequenzauswahl erfolgt über ein 10-bit-Register (f\_sel), das an über die Schalter SW0 bis SW9 gesteuert werden kann.
Die Ausgangsfrequenz berechnet sich nach folgender Formel:

\begin{equation}
    f_{out} = f_{ref} \cdot \frac{f_\_sel}{2^{12}}
\end{equation}

\noindent Dadurch sind Frequenzen im Bereich von 0 Hz bis 12,195 kHz mit einer Frequenzauflösung von 12 Hz einstellbar. 

\noindent Zur Amplitudenbestimmung wird eine Koeffiziententabelle verwendet, die als ein Array mit 4096 Werten mit jeweils 10 bit vorliegt.
Dieses wird vorab mithilfe eines Python-Skripts generiert und stellt diskrete Werte einer Sinusfunktion mit 10 bit Amplitudenauflösung dar.

\noindent Der PWM-Generator verwendet die Phase als Index, um den aktuellen Amplitudenwert aus der Koeffiziententabelle auszulesen.
Ein 10-bit-Zähler zählt die PWM-Ticks, wobei ein Zyklus aus 1024 Ticks, synchron zur Referenzfrequenz, besteht.
Zum Beginn jedes Zyklus wird ein neuer Koeffizient geladen und der Zähler zurückgesetzt.
Das Ausgangssignal wird für eine Anzahl von Ticks entsprechend des Koeffizienten auf '1' gesetzt, danach auf '0'.

\noindent Zur Glättung des PWM-Signals wird ein passiver RC-Tiefpass mit Grenzfrequenz $f_g = 16 kHz$ verwendet.
\begin{equation}
    f_g=\frac{1}{2 \cdot \pi \cdot R \cdot C}
\end{equation}
Mit $R=xxx \Omega$ ergibt sich ein Kondensatorwert von $C=xxx F$

\subsection{Testbenches und Use-Cases}
Zur Verifikation der Modelle auf den verschiedenen Ebenen werden zwei Testbenches 
benötigt.
Eine für das Modell auf algorithmischer Ebene und eine für die Register-Transfer-Ebene.
Beide Testbenches durchlaufen jeweils drei Use-Cases.
Der erste Use-Case ist die Generierung eines Signals mit maximal möglicher Frequenz (f\_sel = 1023).
Als zweites wird ein Signal mit der mittleren möglichen Frequenz generiert (f\_sel = 512).
Zum Schluss wird als dritter Use-Case ein Signal mit der geringsten einstellbaren Frequenz erzeugt (f\_sel = 1).
Diese entspreden 12,195 kHz, 6,1035 kHz und 11,92 Hz.